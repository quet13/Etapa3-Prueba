---
title: "Sesion2_Actividad_Quetzali"
output:
  html_document: default
  pdf_document: default
date: "02-06-2024"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r entorno}
library(coronavirus)
library(tidyverse)

casos <- coronavirus::coronavirus
```

## Antecedentes

* ¿Qué es el COVID19? Es un virus que forma parte de la familia de virus “Coronavirus”, que reciben su nombre por su forma en “corona”. Es el más reciente de los coronavirus, identificado en el 2019 y causa la enfermedad llamada COVID-19, responsable de la actual pandemia.

Existen 7 coronavirus capaces de producir enfermedad en humanos.

* Los coronavirus HCoV-229E, HCoV-OC43, HCoV-NL63 y HCoV-HKU1 son los más frecuentes y circulan entre humanos, suelen causar resfriados leves o enfermedades diarreicas en lactantes.

* Los coronavirus MERS-CoV, SARS-CoV y SARS-CoV-2, circulaban entre animales y mutaron hasta tener la capacidad de infectar al ser humano. Estos 3 virus pueden causar enfermedad respiratoria más grave.

* ¿Cómo se transmite?
La COVID-19 se puede transmitir de 3 formas

La principal es al inhalar aire que contenga las gotitas de saliva que emiten personas enfermas al toser, estornudar o hablar.
Al estar cerca de personas infectadas, las gotitas de saliva que estas emiten al toser estornudar o hablar pueden entrar en contacto con la mucosa de ojos nariz o boca e infectarte.
A través de superficies (fómites). Al tocarse los ojos, nariz o boca después de haber tocado superficies contaminadas.

* ¿Cuáles son los síntomas?
Podrías tener COVID-19 si presentas al menos uno de los siguientes síntomas:

![Imagen de sintomas](imgs/SINTOMAS.png){width="50%"}

En los casos graves puede presentarse:

![Sintomas graves](imgs/SINTOMAS GRAVES.png){width="50%"}

* ¿Cuál es el contexto de los datos que estamos usando? Se recomienda revisar el github del autor del paquete [https://github.com/RamiKrispin/coronavirus] para acceder a los detalles de los datos. También se puede probar con ??coronavirus en RStudio.

## Materiales y métodos

Se empieza por citar la fuente de los datos:

* Se recomienda revisar el github del autor del paquete [https://github.com/RamiKrispin/coronavirus] para acceder a los detalles de los datos. También se puede probar con ??coronavirus en RStudio.

Escribir un párrafo para definir las ecuaciones usadas para medir el impacto de una enfermedad:

* $TasaDeIncidencia = NuevosCasos / Población \times 100,000$

* $TasaDeMortalidad = Defunciones / Población \times 100,000$

## Resultados

* Nuevos casos confirmados en el tiempo (línea de tiempo sobre casos a nivel mundial).

```{r confimados_mundial}
casos |> 
  # filtra tipo de dato que se quiere ver
  filter(type == "confirmed") |> 
  # agrupar con dplyr para poder resumir los datos
  group_by(date) |> 
  summarise(casos = sum(cases, na.rm = TRUE)) |> 
  # graficar con ggplot
  ggplot(aes(x = date, y = casos))+
  geom_line()+
  labs(title = "Nuevos casos confirmados a nivel mundial",
       x = "Fecha",
       y = "# de nuevos casos")
```

* Acumulativo de nuevos casos confirmados en el tiempo.

```{r casos_confirmados_acumulado}
# guardar los datos de nuevos casos
temp1 <- casos |> 
  # filtrar tipo de datos que se quieren ver
  filter(type == "confirmed") |> 
  # agrupar para resumir
  group_by(date) |> 
  summarise(casos = sum(cases, na.rm = TRUE))

# agregar columna de datos acumulativos
temp1$acumulado = cumsum(temp1$casos)

# graficar
temp1 |> 
  ggplot(aes(x = date, y = acumulado))+
  geom_line()+
  labs(title = "Acumulativo de nuevos casos confirmados",
       x = "Fecha",
       y = "# de nuevos casos")

```

* Defunciones reportadas a nivel mundial.

```{r defunciones_mundial}
casos |> 
  # filtra tipo de dato que se quiere ver
  filter(type == "death") |> 
  # agrupar con dplyr para poder resumir los datos
  group_by(date) |> 
  summarise(casos = sum(cases, na.rm = TRUE)) |> 
  # graficar con ggplot
  ggplot(aes(x = date, y = casos))+
  geom_line()+
  labs(title = "Defunciones a nivel mundial",
       x = "Fecha",
       y = "# de defunciones")
```


* Defunciones acumuladas a nivel mundial

```{r defunciones_acumuladas_mundial}
temp1 <- casos |> 
  # filtrar tipo de datos que se quieren ver
  filter(type == "death") |> 
  # agrupar para resumir
  group_by(date) |> 
  summarise(casos = sum(cases, na.rm = TRUE))

# agregar columna de datos acumulativos
temp1$acumulado = cumsum(temp1$casos)

# graficar
temp1 |> 
  ggplot(aes(x = date, y = acumulado))+
  geom_line()+
  labs(title = "Acumulativo de defunciones",
       x = "Fecha",
       y = "# de defunciones")
```

* Casos confirmados y defunciones en México (línea de tiempo sobre casos confirmados en México).

```{r casos_mexico}
temp_mx <- casos |> 
  # filtrar tipo de datos que se quieren ver
  filter(type != "recovery") |> 
  filter(country == "Mexico") |> 
  # agrupar para resumir
  group_by(date, type) |> 
  summarise(casos = sum(cases, na.rm = TRUE)) |> 
  pivot_wider(names_from = "type", values_from = "casos")

# agregar columna de datos acumulativos

temp_mx$acumulado_confirmado = cumsum(temp_mx$confirmed)
temp_mx$acumulado_muerte = cumsum(temp_mx$death)

# graficar
temp_mx |> 
  pivot_longer(cols = c(confirmed:acumulado_muerte),
               names_to = "Variable", values_to = "Cuenta") |> 
  filter(Variable == "confirmed" | Variable == "death") |> 
  ggplot(aes(x = date, y = Cuenta, color = Variable))+
  geom_line()+
  labs(title = "Casos confirmados y defunciones en México",
       x = "Fecha",
       y = "# de casos")
```

* Casos acumulados en México.

```{r defunciones_mexico}
# graficar
temp_mx |> 
  pivot_longer(cols = c(confirmed:acumulado_muerte),
               names_to = "Variable", values_to = "Cuenta") |> 
  filter(Variable == "acumulado_confirmado" | Variable == "acumulado_muerte") |> 
  ggplot(aes(x = date, y = Cuenta, color = Variable))+
  geom_line()+
  labs(title = "Casos confirmados y defunciones en México",
       x = "Fecha",
       y = "# de casos")
```

* Tasa de incidencia a nivel mundial por país, por año.
  + Presentar la información en un datatable, para facilitar el acceso a los datos.

```{r tasa_incidencia_mundial}
T_Incidencia <- casos |> 
  # filtrar tipo de datos 
  filter(type == "confirmed") |> 
  # agrupar para después resumir los datos
  group_by(date, country) |> 
  summarise(casos = sum(cases, na.rm = TRUE),
            poblacion = sum(population, na.rm = TRUE)) |> 
  # agregar columna de año
  mutate(año = format(date, "%Y")) |> 
  # deshacer los grupos anteriores para agrupar pero ahora por año
  ungroup() |> 
  group_by(año, country) |> 
  summarise(casos = sum(casos, na.rm = TRUE),
            poblacion = mean(poblacion, na.rm = TRUE)) |> 
  # filtrar países con población 0, para evitar NaN e Infinitos
  filter(poblacion > 0) |> 
  # calcular tasa de incidencia
  mutate(tasa_incidencia = casos / poblacion * 100000)

DT::datatable(T_Incidencia)
```

* Tasa de mortalidad a nivel mundial por país
+ Presentar la información en un datatable, para facilitar el acceso a los datos.

```{r tasa_mortalidad_mundial}
T_Mortalidad <- casos |> 
  # filtrar tipo de datos 
  filter(type == "death") |> 
  # agrupar para después resumir los datos
  group_by(date, country) |> 
  summarise(casos = sum(cases, na.rm = TRUE),
            poblacion = sum(population, na.rm = TRUE)) |> 
  # agregar columna de año
  mutate(año = format(date, "%Y")) |> 
  # deshacer los grupos anteriores para agrupar pero ahora por año
  ungroup() |> 
  group_by(año, country) |> 
  summarise(casos = sum(casos, na.rm = TRUE),
            poblacion = mean(poblacion, na.rm = TRUE)) |> 
  # filtrar países con población 0, para evitar NaN e Infinitos
  filter(poblacion > 0) |> 
  # calcular tasa de mortalidad
  mutate(tasa_mortalidad = casos / poblacion * 100000)

DT::datatable(T_Mortalidad)
```

* Indicar valores de tasa de incidencia y mortalidad para México

```{r tasa_incidencia_mexico}
# filtrar información a nivel país
T_Incidencia |> 
  filter(country == "Mexico")
```
```{r tasa_mortalidad_mexico}
# filtrar información a nivel país
T_Mortalidad |> 
  filter(country == "Mexico")
```


## Conclusiones

* Los niños se infectan igual que los adultos cuando están en contacto con una fuente de infección. El porcentaje de transmisión de la infección en los niños en el entorno doméstico se sitúa alrededor del 17%.

* En los niños la enfermedad se manifiesta de forma leve en el 99% de los casos.
La COVID-19 afecta a un 14% de las embarazadas, la mayoría asintomáticas o leves. Las pocas gestantes que presentan síntomas más graves son las que han padecido la enfermedad durante el tercer trimestre de gestación.

## Bibliografía

* Se debe incluir también la cita al paquete de datos `coronavirus` de R.
